This is now all implemented except the checks from comment 844/adb/e94.
